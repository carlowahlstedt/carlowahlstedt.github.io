---
layout: post
title: 'SharePoint and Powershell: Making Life Easier'
date: '2012-01-09T10:01:00.001-05:00'
author: Carlo
tags:
- PowerShell
- SharePoint
modified_time: '2012-01-09T12:55:54.256-05:00'
blogger_id: tag:blogger.com,1999:blog-1115978604548657664.post-3516533175554439913
blogger_orig_url: https://thewahlstedts.blogspot.com/2012/01/sharepoint-and-powershell-making-life.html
---

There's no two ways about it, SharePoint has not been fun for me. I don't know if it's because it's a monster or if I just don't enjoy dealing with it. What I can tell you is that it seems like there's some type of issue at every corner I turn and every time I try to do something simple it seems to take 2x or 3x the amount of work it seems like it should. With that said, using PowerShell with SharePoint was a blast.<br /><br />While converting data, I was faced with the task of moving over a bunch of files from a file system into SharePoint. That's easy enough using Windows Explorer from file system to SharePoint, just drag and drop. However, I then needed to append some properties onto the newly imported files and I have the needed information in a csv file.<br /><br />After some testing of the file, I found that I needed to convert it to a tab delimited file because there were some commas in the data and I didn't see a way to handle data wrapped in quotes with PowerShell. After figuring this out the import went fairly smooth. Here's the code I used to do the importing:<br /><br /><pre class="brush:java">[void][System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SharePoint")<br /><br />#some temp variables if we want to update other lists later<br />$SharePointSite = "http://sharepoint/"<br />$SharePointWeb = "Site"<br />$SharePointList = "ListName"<br />#where the file you're going to read data from to get the info is located<br />$workingdir="C:\Powershell\data.txt"<br /><br />#make the connection to sharepoint and to the list<br />$spSite = new-object Microsoft.SharePoint.SPSite($SharePointSite)<br />$spWeb = $spSite.OpenWeb($SharePointWeb)<br />$spList = $spWeb.Lists[$SharePointList]<br />$spItems = $spList.items | Sort -Property Name<br /><br />#import a csv file with a tab delimiter<br />$lines = Import-Csv -Path $workingdir -Delimiter `t<br /><br />$getLine = 0<br />#loop through all of the lists<br />#update each one from the file we generated from SQL<br />foreach ($spItem in $spItems)<br />{<br />    $line = $lines[$getLine]<br /><br />    if($spItem["Name"] -eq $line.name + ".wmv")<br />    {<br />        $spItem["Title"] = $line.title<br />        $spItem["Category"] = $line.category<br />        $spItem["Scheduling Start Date"] = $line.date<br /><br />        #write-host $line.name<br />        #write-host $spItem["Title"]<br />        #write-host $spItem["Category"]<br />        #write-host $spItem["Scheduling Start Date"]<br />        #write-host "-----------------------------------"<br />        $spItem.Update()<br />        write-host $getLine<br />    }<br />    else<br />    {<br />        write-host "Failed to update because name didn't match:"<br />        write-host "name from file: " + $line.name<br />        write-host "name from sp: " + $spItem["Name"]<br />        write-host "line: " + $getLine<br />        write-host "-----------------------------------"<br />    }<br />    $getLine++;<br />}<br /></pre><br /><br />I also needed to do some importing into a list from that same file. Much of the code is the same but here's what I changed:<br /><br /><pre class="brush:java">[void][System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SharePoint")<br /><br />#some temp variables if we want to update other lists later<br />$SharePointSite = "http://sharepoint/"<br />$SharePointWeb = "Site"<br />$SharePointList = "List"<br />#where the file you're going to read data from to get the info is located<br />$workingdir="C:\Powershell\data.txt"<br /><br />#make the connection to sharepoint and to the list<br />$spSite = new-object Microsoft.SharePoint.SPSite($SharePointSite)<br />$spWeb = $spSite.OpenWeb($SharePointWeb)<br />$spList = $spWeb.Lists[$SharePointList]<br />$spItems = $spList.items | Sort -Property Name<br /><br />#import a csv file with a tab delimiter<br />$lines = Import-Csv -Path $workingdir -Delimiter `t<br /><br />$getLine = 0<br />#loop through all of the line and insert a new item<br />foreach ($line in $lines)<br />{<br />    $spListItem = $spList.AddItem()<br />    $spListItem["Subject"] = $line.name<br />    $spListItem["Body"] = $line.title <br />    $spListItem["Last Updated"] = $line.date<br />    $spListItem.Update()<br /><br />    write-host $getLine<br /> <br />    $getLine++;<br />}<br /></pre><br /><div>Two things to note with the scripts:<br /><ol><li>Both scripts have a counter that is&nbsp;output&nbsp;to tell how much data is inserted and also to give an idea of the progress</li><li>The looping done in the update script used sorting to make sure that the names would match but also checked that the names matched to make sure.</li></ol></div><script src="http://crux-framework-tools.googlecode.com/svn/trunk/misc/highlight/highlightLoader.js"></script>