---
layout: post
title: SharePoint Calendar and PowerShell
date: '2012-01-21T11:16:00.004-05:00'
author: Carlo
tags:
- PowerShell
- Calendar
- SharePoint
modified_time: '2012-01-21T11:34:53.137-05:00'
thumbnail: http://2.bp.blogspot.com/-vOhwsxouHBE/Txro-YRHGXI/AAAAAAABSOI/bJwJSUu9k8c/s72-c/caml.png
blogger_id: tag:blogger.com,1999:blog-1115978604548657664.post-672763522323794644
blogger_orig_url: https://thewahlstedts.blogspot.com/2012/01/sharepoint-calendar-and-powershell.html
---

As I continue to work with SharePoint, I continue to find that PowerShell is handy tool. The more I use PowerShell the more powerful I find it to be in general.<br /><br />In this&nbsp;scenario, I was tasked to send a daily email of the events of the day on a given calendar. I realize that this seems counter productive, as the users could easily just look at SharePoint, however I don't call the shots. So, I took my task to heart and after exhausting my ideas someone suggested PowerShell. DING! Why hadn't I thought of that? I guess I still wasn't convinced of the power of the shell (bad joke, I'm full of them). The plan became, create a script that will get the days events and send an email to the desired users. The only other piece left would be how to make it run and the plan there was to use Task Schedule that's built into Windows. I'm not going to cover that piece here but you'll need to take into consideration any authentication you might need to do with your mail server relating to the user your sending the email as.<br /><br />If you read my previous post you'll see that the top of the script does the same things. Load SharePoint assemblies, connect to SharePoint and get the calendar needed (which is just another form of a list). However, this time I only need specific data and since it's a calendar I want to filter on date. In this instance I tried several things, but eventually settled on using&nbsp;<a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spquery.aspx">SPQuery</a>. You'll see after it's&nbsp;instantiated, that it get assigned a <a href="http://msdn.microsoft.com/en-us/library/ms467521.aspx">query</a>. The query tells us to get all event dates that are equal to today. If you open up SharePoint and look at the calendar you'll see that the different views of the calendar match what can be placed in this script. So if you change it to month, then it would give you all events for the month. Then we need to set the calendar date to today, expand all recurring events, and order them. Finally we can pass the query to the GetItems method and it will give us the items as we've requested.<br /><br />Here's the caml query as it didn't want to show up because it was confusing it with HTML:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-vOhwsxouHBE/Txro-YRHGXI/AAAAAAABSOI/bJwJSUu9k8c/s1600/caml.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-vOhwsxouHBE/Txro-YRHGXI/AAAAAAABSOI/bJwJSUu9k8c/s1600/caml.png" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />Now all that's left to do is loop through the items and build a string for the body of the email and then send the email. Enjoy!<br /><br /><pre class="brush:java">[void][System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SharePoint")<br /><br />#some temp variables if we want to update other lists later<br />$SharePointSite = "http://sharepoint/"<br />$SharePointWeb = "List"<br />$SharePointList = "Calendar"<br /><br />#make the connection to sharepoint and to the list<br />$spSite = new-object Microsoft.SharePoint.SPSite($SharePointSite)<br />$spWeb = $spSite.OpenWeb($SharePointWeb)<br />$spList = $spWeb.Lists[$SharePointList]<br /><br />$query = New-Object Microsoft.SharePoint.SPQuery <br />$query.query = ""<br />$query.CalendarDate = Get-Date<br />$query.RecurrenceOrderBy = $true<br />$query.ExpandRecurrence = $true<br />$spItems = $spList.GetItems($query)<br /><br />$emailBody = "Start Email Body"<br />#loop through all of the lists and update each one from the file we generated from SQL<br />foreach ($spItem in $spItems)<br />{<br /> #write-host $spItem["Title"] " - " $spItem["Start Time"] " - " $spItem["End Time"]<br /> #write-host "-----------------------------------"<br /> $emailBody += $spItem["Title"] + ""<br />}<br /><br />$spSite.Dispose()<br /><br />$emailFrom = "person@domain.com"<br />$emailTo = "person@domain.com"<br />$emailCc = "person@domain.com"<br />$emailSubject = "My Email"<br />send-mailmessage -from $emailFrom -to $emailTo -cc $emailCc -subject $emailSubject -body $emailBody -smtpServer mail.domain.com -BodyAsHtml:$true<br /></pre><div><br /></div><a href="http://blogs.technet.com/b/heyscriptingguy/archive/2010/09/22/use-powershell-to-manage-lists-views-and-items-in-sharepoint.aspx">Helpful reference</a> when I was getting started with PowerShell.<br /><br />