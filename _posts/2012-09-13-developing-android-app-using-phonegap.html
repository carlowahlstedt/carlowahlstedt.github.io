---
layout: post
title: Developing an Android App using PhoneGap
date: '2012-09-13T23:58:00.001-04:00'
author: Carlo
tags:
- walled garden
- nomad
- application
- drawsuar
- google play
- Android
- HTML5
- touch
- JavaScript
- canvas
- CSS
- eclipse
- js
- PhoneGap
- app
- java
modified_time: '2012-09-13T23:58:09.518-04:00'
thumbnail: http://1.bp.blogspot.com/XEmKzWqT5WUDHDnk_BXw0je2PU8MSyv0kb62EHinhvDOJojLsxytXG6EZKmKEgZHfw=s72-c
blogger_id: tag:blogger.com,1999:blog-1115978604548657664.post-1095267222810688490
blogger_orig_url: https://thewahlstedts.blogspot.com/2012/09/developing-android-app-using-phonegap.html
---

Since Android was introduced I've been excited about the platform because iOS was always so limited it what you could do, you know the whole <a href="http://en.wikipedia.org/wiki/Walled_garden_(technology)" target="_blank">"walled garden"</a> thing. Tinkering, exploring, and creating have always been my thing. Also, the Windows Mobile phones of the time were large and chunky with poor resistive touch screens. So, naturally I always wanted to write an app for Android but it always seemed to involve so much time trying to learn a new language (well I already somewhat knew Java) and a new platform/environment/ecosystem. Just because I knew and had previously done Java I was in way a wiz. Also the context of Android presented it's own challenging of understanding how the underlying OS worked. Fast forward 4 years or so and I've finally created my first Android app (which should be able to be easily ported to run on iOS except that I refuse to give Apple $99 to let me put it in the app store). Surprising however I used very little Java and a whole lot more JavaScript, CSS, and HTML5.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://cdn.devlup.com/wp-content/uploads/2011/08/html5_css_javascript.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://cdn.devlup.com/wp-content/uploads/2011/08/html5_css_javascript.png" /></a></div><br /><br /><br />I used <a href="http://phonegap.com/" target="_blank">PhoneGap</a>, which seems to be gaining a lot of traction. Before I go into that let me back up and explain how I got there.<br /><br /><a href="https://play.google.com/store/apps/details?id=com.thewahlstedts.drawsaur" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/XEmKzWqT5WUDHDnk_BXw0je2PU8MSyv0kb62EHinhvDOJojLsxytXG6EZKmKEgZHfw" width="200" /></a>It all really started because I wanted to learn HTML5. I had been wanting to learn it since it burst onto the scene but like writing an Android app I just never put my mind to it. I finally found something that caught my interest enough that I&nbsp;pursued&nbsp;it. I wanted to be able to draw, like a paint application. A little research quickly turned up a <a href="http://www.html5canvastutorials.com/" target="_blank">canvas</a>. I had a working sample in minutes...for the browser. Within a decent amount of time I had adapted it to be my own design, adjusting the layout to be full screen and then testing it in a mobile browser. Except that it didn't work. A little research turned up that mobile browsers required a different set of events. Changing the mousedown event to a form of a touch start event fixed the issue in the browser...for my Android Gingerbread device. As soon as someone with an ICS device tested it I was out of luck again. A little more research turned up a different set of touch events for newer browsers. Once implemented I wanted to make it a native app on the phone but I didn't want to change much code. After a little research and testing out <a href="http://www.vsnomad.com/" target="_blank">nomad</a>&nbsp;(which didn't quite work for me but I may have not set something up right because I tend to not fully read instructions when tinkering, surprise!), landed on PhoneGap using <a href="http://www.eclipse.org/" target="_blank">Eclipse</a> on OSX. It worked and I had <a href="https://play.google.com/store/apps/details?id=com.thewahlstedts.drawsaur" target="_blank">Drawsaur in the Google Play store</a> in no time. Want to know how I did it? Thought you'd never ask!<br /><br />First off the only HTML5 tag I used was the...yeah you guessed it (if you've read everything to here), the canvas tag:<br /><br /><pre class="brush:java"><canvas id="canvas">Sorry! Your browser doesn't support Canvas.</canvas><br /></pre><br />The rest was JavaScript, aside from being good and trying to follow layout rules to use CSS. In my js I found out that I needed to be able to get the canvas and context like this:<br /><pre class="brush:java">var canvas = document.getElementById("canvas"),<br />    ctxt = canvas.getContext("2d");<br /></pre><br />I did some layout and other code but the next thing I found was that I need those oh so elusive events: <br /><pre class="brush:java">var self = {<br />    //bind click events<br />    init: function() {<br />        canvas.addEventListener('touchstart', self.preDraw, false);<br />        canvas.addEventListener('touchmove', self.draw, false);<br />    },<br /><br />return self.init();<br /></pre><br />When calling these events there was certain way in which the touches were, let me say best registered: <br /><pre class="brush:java">preDraw: function(event) {<br />    $.each(event.touches, function(i, touch) {<br />     var x = this.pageX - offset.left,<br />      y = this.pageY - offset.top,<br />        id = touch.identifier;<br />    });<br />    //prevent scrolling<br />    event.preventDefault();<br />},<br /></pre><br />I also had to read and learn a lot about how to put images on the canvas: <br /><pre class="brush:java">var trash = new Image(); <br />trash.src = "trashcan.png"; <br />trash.onload = function() { ctxt.drawImage(trash, trashX, trashY-adWidth); }<br /></pre><br />Which turned out to be very similar to how you used the canvas and drew on the canvas in general. Like drawing a rectangle: <br /><pre class="brush:java">ctxt.rect(drawingAreaX, drawingAreaY, drawingAreaWidth, drawingAreaHeight);<br /></pre><br />Or a circle: <br /><pre class="brush:java">ctxt.arc(cursor[i].location, locY, cursor[i].size, 0*Math.PI, 2*Math.PI);<br /></pre><br />In the end, the latest version of Drawsaur's code looks like this: <br /><pre class="brush:java">/*********************************************************<br />* Drawsaur<br />* Created 9/2/2012 by Carlo Wahlstedt<br />*<br />* This code uses GPL v3. Please following accordingly.<br />*<br />* This code is distributed in the hope that it will be useful,<br />*       WITHOUT ANY WARRANTY or implied warranty.<br />*<br />**********************************************************/<br />//this is what starts the drawing<br />$(function(){<br />  var drawing = new DrawingApp(); <br />});<br />//here is where all of the work is done<br />var DrawingApp = function(options) {<br />    // grab canvas element<br />    var canvas = document.getElementById("canvas"),<br />        ctxt = canvas.getContext("2d");<br />     hasAds = document.getElementById("ads"),<br />     divColors = document.getElementById("colors"),<br />     canvasColor = document.getElementById("colorCanvas"),<br />        ctxtColor = colorCanvas.getContext("2d");<br />        curColor = "black",<br />  curSize = 2,<br />  lines = [,,],<br />     offset = $(canvas).offset(),<br />     colorsShowing = false,<br />     selColor = curColor;<br />     adWidth = 50;<br /><br />    canvas.width = window.innerWidth;<br />    canvas.height = window.innerHeight;<br />    canvasColor.width = canvas.width - 25;<br />    canvasColor.height = canvas.height - 170;<br /><br />    //if the ads aren't there then don't fix the layout<br />    if (hasAds == null) { adWidth=0; }<br /><br />    //setup the canvas context<br />    ctxt.lineWidth = 5;<br />    ctxt.lineCap = "round";<br />    ctxt.pX = undefined;<br />    ctxt.pY = undefined;<br /> <br /> //setup the drawing area<br /> var drawingAreaX = 0,<br />  drawingAreaY = 0,<br />  drawingAreaWidth = canvas.width - 20,<br />  drawingAreaHeight = canvas.height - (60 + adWidth);<br /><br /> //list of pen sizes<br /> var cursor = [];<br /> cursor.push({ size:2, radius:2, location:canvas.width-30 });<br /> cursor.push({ size:5, radius:5, location:canvas.width-55 });<br /> cursor.push({ size:7, radius:10, location:canvas.width-80 });<br /> cursor.push({ size:10, radius:20, location:canvas.width-105 });<br /><br /> //draw the trashcan<br />    var trashX = cursor[cursor.length-1].location-40,<br />     trashY = canvas.height-40;<br /> var trash = new Image(); <br /> trash.src = "trashcan.png"; <br />  trash.onload = function() { ctxt.drawImage(trash, trashX, trashY-adWidth); }<br /><br />    var colorX = 5,<br />     colorY = canvas.height-45;<br /> var iconColors = new Image();<br /> iconColors.src = "colors.png"; <br />  iconColors.onload = function() { ctxt.drawImage(iconColors, colorX, colorY-adWidth); }<br /><br /> //where the magic happens<br />    var self = {<br />        //bind click events<br />        init: function() {<br />            canvas.addEventListener('touchstart', self.preDraw, false);<br />            canvas.addEventListener('touchmove', self.draw, false);<br />        },<br />        //draws the rectangle<br />        drawRect: function() {<br />         ctxt.beginPath();<br />   ctxt.rect(drawingAreaX, drawingAreaY, drawingAreaWidth, drawingAreaHeight);<br />   ctxt.closePath();<br />   ctxt.lineWidth = "1";<br />   ctxt.strokeStyle = "black";<br />   ctxt.fillStyle = "white";<br />   ctxt.fill();<br />   ctxt.strokeRect(drawingAreaX, drawingAreaY, drawingAreaWidth+7, drawingAreaHeight+7);<br />  },<br />        //updates the UI to tell the user which pen size is now selected<br />        drawCursors: function() {<br />   var locY = canvas.height - (35 + adWidth);<br />   for (i = 0; i &lt; cursor.length; i++) {<br />     ctxt.lineWidth = 4;<br />    ctxt.beginPath();<br />    ctxt.arc(cursor[i].location, locY, cursor[i].size, 0*Math.PI, 2*Math.PI);<br />    ctxt.closePath();<br />    ctxt.strokeStyle = "grey"<br />    ctxt.stroke();<br />    if (curSize == cursor[i].radius) {<br />     ctxt.fillStyle = 'black';<br />     ctxt.fill();<br />    } else {<br />     ctxt.fillStyle = 'white';<br />     ctxt.fill();<br />    }<br />   }<br />  },<br />  //updates the UI to show the color picker<br />        showColors: function() {<br />   divColors.style.visibility = "visible";<br />   divColors.style.display = "inline-block";<br />   canvas.style.visible = "hidden";<br />   canvas.style.display = "none";<br />   colorsShowing = true;<br />  },<br />  //updates the UI to hide the color picker<br />        hideColors: function() {<br />   divColors.style.visibility = "hidden";<br />   divColors.style.display = "none";<br />   canvas.style.visible = "visible";<br />   canvas.style.display = "inline";<br />   colorsShowing = false;<br />  },<br />  //this is the single press event<br />        preDraw: function(event) {<br />            $.each(event.touches, function(i, touch) {<br />             var x = this.pageX - offset.left,<br />              y = this.pageY - offset.top,<br />                 id = touch.identifier;<br /><br />                //if it's in the drawing area then record the draw<br />             if (y &lt; drawingAreaHeight &amp;&amp; x &lt; drawingAreaWidth) {<br />                 lines[id] = { x     : x, <br />                               y     : y, <br />                               color : curColor,<br />                               size  : curSize<br />                            };<br />                 //force a dot to be drawn<br />                    self.move(id, 1, 0);<br />             } else {<br />              //this checks if the cusor size needs to be changed<br />              var redraw = false;<br />     for (i = 0; i &lt; cursor.length; i++) {<br />               if (x &gt; cursor[i].location-25 &amp;&amp; x &lt; cursor[i].location+15) {<br />                curSize = cursor[i].radius;<br />                redraw = true;<br />      }<br />     }<br />              if (redraw) self.drawCursors();<br /><br />     //if the color wheel is pressed<br />     if (x &gt; colorX-20 &amp;&amp; x &lt; colorX+40) {<br />      self.showColors();<br />     }<br /><br />     //check to see if the trashcan was clicked<br />     if (x &gt; trashX &amp;&amp; x &lt; trashX+20) {<br />      var ck = confirm("Are you sure you want to clear your drawing?");<br />      if (ck == true) {<br />       lines = [];<br />       ctxt.clearRect(drawingAreaX, drawingAreaY, drawingAreaWidth+10, drawingAreaHeight+10);<br />       self.drawRect();<br />      }<br />     }<br />             }<br />            });<br />   //prevent scrolling<br />            event.preventDefault();<br />        },<br />        //when the screen is touched this where the drawing happens<br />        draw: function(event) {<br />            $.each(event.touches, function(i, touch) {<br />                var x = this.pageX - offset.left,<br />                 y = this.pageY - offset.top;<br />                //only store the keystrokes if they are in the drawing area<br />             if (y &lt; drawingAreaHeight &amp;&amp; x &lt; drawingAreaWidth) {<br />                 var id = touch.identifier,<br />                     moveX = x - lines[id].x,<br />                     moveY = y - lines[id].y,<br />                  ret = self.move(id, moveX, moveY);<br />                 lines[id].x = ret.x;<br />                 lines[id].y = ret.y;<br />                }<br />            });<br />   //prevents scrolling<br />            event.preventDefault();<br />        },<br />        //this is where the actual drawing on the screen happens<br />        move: function(i, changeX, changeY) {<br />            ctxt.strokeStyle = lines[i].color;<br />   ctxt.lineWidth = lines[i].size;<br />            ctxt.beginPath();<br />            ctxt.moveTo(lines[i].x, lines[i].y);<br /><br />            ctxt.lineTo(lines[i].x + changeX, lines[i].y + changeY);<br />            ctxt.stroke();<br />            ctxt.closePath();<br /><br />            return { x: lines[i].x + changeX, y: lines[i].y + changeY };<br />        }<br />    };<br /> //create the box to draw in<br /> self.drawRect();<br /> //now draw the cursors on screen and select the one in use<br /> self.drawCursors();<br /><br /> //all the logic for the color picker<br />  var colorWindow = {<br />  init: function(imageObj) {<br />      ctxtColor.strokeStyle = "#444";<br />      ctxtColor.lineWidth = 2;<br />      //draw the color picker image<br />      ctxtColor.drawImage(imageObj, 0, 0);<br />      colorWindow.drawColorSquare(curColor, imageObj);<br />   <br />    //create the accept button<br />      ctxtColor.beginPath();<br />      ctxtColor.fillStyle = "grey";<br />      var x = 15,<br />       y = 340,<br />       xS = 100,<br />       yS = 40;<br />      ctxtColor.fillRect(x, y, xS, yS);<br />      ctxtColor.strokeRect(x, y, xS, yS);<br />      ctxtColor.fillStyle = "black";<br />      ctxtColor.font="20px Arial";<br />      ctxtColor.fillText("Accept", x+20, 365);<br /><br />    //create the cancel button<br />      ctxtColor.beginPath();<br />      ctxtColor.fillStyle = "grey";<br />      x += 125;<br />      y += 0;<br />      xS += 0;<br />      yS += 0;<br />      ctxtColor.fillRect(x, y, xS, yS);<br />      ctxtColor.strokeRect(x, y, xS, yS);<br />      ctxtColor.fillStyle = "black";<br />      ctxtColor.font="20px Arial";<br />      ctxtColor.fillText("Cancel", x+20, 365);<br /><br />      //set the fill style back so that when we try to color it's correct<br />      ctxtColor.fillStyle = curColor;<br /><br />      canvasColor.addEventListener("touchstart", colorWindow.getColor, false);<br />      canvasColor.addEventListener("touchmove", colorWindow.getColor, false);<br />  },<br />  //touch events<br />  getColor: function(evt){<br />         $.each(event.touches, function(i, touch) {<br />          var x = this.pageX - offset.left,<br />              y = this.pageY - offset.top,<br />              padding = 20,<br />     color = undefined;<br />     //only get a color if it's over the color picker<br />          if (x &lt; imageObj.width+padding &amp;&amp; x &gt; padding &amp;&amp;<br />           y &lt; imageObj.height+padding &amp;&amp; y &gt; padding) {<br />              //color picker image is 256x256 and is offset by 10px from top and bottom<br />              var imageData = ctxtColor.getImageData(0, 0, imageObj.width, imageObj.width);<br />              var data = imageData.data;<br />              x -= padding<br />              y -= padding<br />              var red = data[((imageObj.width * y) + x) * 4];<br />              var green = data[((imageObj.width * y) + x) * 4 + 1];<br />              var blue = data[((imageObj.width * y) + x) * 4 + 2];<br />              x += padding<br />              y += padding<br />              <br />              color = "rgb(" + red + "," + green + "," + blue + ")";<br />          }<br />     //if a color was selected then update the square<br />          if (color) {<br />              colorWindow.drawColorSquare(color, imageObj);<br />              selColor = color;<br />          }<br />          //for pressing the buttons<br />          if (evt.type == "touchstart" &amp;&amp; <br />           x &gt; 15 &amp;&amp; x &lt; 125 &amp;&amp;<br />           y &gt; 360 &amp;&amp; y &lt; 410)<br />          {<br />           curColor = selColor;<br />           self.hideColors();<br />          } else if (evt.type == "touchstart" &amp;&amp; <br />           x &gt; 150 &amp;&amp; x &lt; 275 &amp;&amp;<br />           y &gt; 360 &amp;&amp; y &lt; 410)<br />          {<br />              colorWindow.drawColorSquare(curColor, imageObj);<br />           self.hideColors();<br />          }<br />         });<br />   //prevent scrolling<br />            event.preventDefault();<br />     },<br />     //draws/updates the square that shows the color selected from the picker<br />  drawColorSquare: function(color, imageObj){<br />      var colorRectX = 200,<br />       colorRectY = 50,<br />    squareX = 25,<br />       squareY = 275;<br />      ctxtColor.beginPath();<br />      ctxtColor.fillStyle = color;<br />      ctxtColor.fillRect(squareX, squareY, colorRectX, colorRectY);<br />      ctxtColor.strokeRect(squareX, squareY, colorRectX, colorRectY);<br />  }<br />    };<br />    //the color picker image<br />  var imageObj = new Image();<br />    imageObj.src = "color_picker.png";<br />    imageObj.onload = function(){ colorWindow.init(this); };<br /> <br /> //starts the drawing app<br />    return self.init();<br />};<br /></pre><br />You're going to want to follow the <a href="http://docs.phonegap.com/en/2.0.0/guide_getting-started_android_index.md.html#Getting%20Started%20with%20Android" target="_blank">PhoneGap Android tutorial</a>&nbsp;to help get you started on using Eclipse and getting an apk compiled for Android. I hope you enjoy what I've thrown together here and it will help you learn something. If any graphic artists out there want to donate some awesome graphics to improve my apps that would be greatly welcomed, although I'm not promising I'll use anything thrown my way. And as always, feel free to leave questions and comments!<script src="http://crux-framework-tools.googlecode.com/svn/trunk/misc/highlight/highlightLoader.js"></script><br /><br />