---
layout: post
title: Searching with PowerShell
date: '2012-03-12T00:16:00.001-04:00'
author: Carlo
tags:
- SQL
- PowerShell
- Stored Procedures
- Code
- File Searching
modified_time: '2012-03-12T00:16:25.443-04:00'
blogger_id: tag:blogger.com,1999:blog-1115978604548657664.post-5484090682097205633
blogger_orig_url: https://thewahlstedts.blogspot.com/2012/03/searching-with-powershell.html
---

Recently, while cleaning up a database, I found myself doing a lot of manual searching in some code to see if stored procedures existed. Like any good Computer Scientist, automation came to mind.&nbsp;<a href="http://www.nytimes.com/2011/10/24/technology/economists-see-more-jobs-for-machines-not-people.html" target="_blank">Who really wants to manually complete a task that can be automated?</a>&nbsp;Then came my recent superhero, PowerShell, to the rescue.<br /><div><br /></div><div>First, was to check to see if it could be done. Sure, it seemed obvious enough (at least to me) that it could be. Otherwise PowerShell was about to loose it's name. Having worked enough with it previously the real question was, Can PowerShell search an entire directory recursively? After working with the&nbsp;<a href="http://technet.microsoft.com/en-us/library/bb648597(v=vs.85).aspx" target="_blank">cmdlet</a>&nbsp;<a href="http://technet.microsoft.com/en-us/library/dd315403.aspx" target="_blank">Select-String</a>&nbsp;for a little bit it seemed that it alone wasn't going to get the job done. However, never fear,&nbsp;<a href="http://technet.microsoft.com/en-us/library/dd347686.aspx" target="_blank">Get-Childitem</a>&nbsp;came in and saved the day.</div><div><br /></div><div>Finally, once a proof of concept was complete, the rest of the script needed to be formulated to take more than one input. There would be no point to automating this if it didn't take multiple inputs and search on them. In the beginning searching code for stored procedures was the object, however another trait of a good computer scientist it to know when to make something generic enough to make it reusable. If you read one of my previous posts you know that you can compile PowerShell scripts together and make your own library of functions. Why not do that here?</div><div><br /></div><pre class="brush:java">$outFile = "Z:\PowerShell\FileSearch\results.sql"<br />$workingFile = "Z:\PowerShell\FileSearch\file.txt"<br />$codePath = "C:\Projects\SearchingProject\*"<br /><br />$fileContents = get-content $workingFile<br />$count = $fileContents | Measure-Object<br />$counter = 1<br />$sqlDrop = ""<br /><br />$startTime = Get-Date<br />foreach ($storedProcedure in $fileContents)<br />{<br />    $results = Get-Childitem $codePath -recurse | Select-String -pattern $storedProcedure -List<br /><br />    if($results -eq $null)<br />    {<br />        $sqlDrop += "DROP PROCEDURE [" + $storedProcedure + "]`n"<br />    }<br />    <br />    write-host $counter " of " $count.count<br />    $counter++<br />}<br />$endTime = Get-Date<br /><br />$sqlDrop += "/*`n"<br />$sqlDrop += "* Start Time: " + $startTime + "`n"<br />$sqlDrop += "* End Time: " + $endTime + "`n"<br />$sqlDrop += "* Total Time: " + ($endTime - $startTime) + "`n*/"<br />$sqlDrop | Out-File $outFile<br /><br /></pre><br /><div>As a side note, this script was specified so it would output the text and file type needed to complete this task. For good measure I added a beginning and ending time to the searching. It's always nice to see how long something takes. I'm a metrics kinda guy. Until next time, <a href="http://thedoghousediaries.com/3468" target="_blank">think about your driving habits</a>.<br /><br /></div>